(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,33525,(e,t,a)=>{"use strict";Object.defineProperty(a,"__esModule",{value:!0}),Object.defineProperty(a,"warnOnce",{enumerable:!0,get:function(){return n}});let n=e=>{}},52683,e=>{"use strict";e.s(["default",()=>f],52683);var t=e.i(43476),a=e.i(71645),n=e.i(25697),s=e.i(37727);function o(e){let{isOpen:a,onClose:n,title:o,children:i}=e;return a?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50",onClick:n}),(0,t.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:(0,t.jsxs)("div",{className:"bg-[#1a1a1a] border border-[#2a2a2a] rounded-xl max-w-md w-full shadow-2xl",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between p-4 border-b border-[#2a2a2a]",children:[(0,t.jsx)("h2",{className:"text-lg font-semibold text-gray-100",children:o}),(0,t.jsx)("button",{onClick:n,className:"p-1 hover:bg-[#2a2a2a] rounded-lg transition-colors text-gray-400 hover:text-gray-200",children:(0,t.jsx)(s.X,{size:20})})]}),(0,t.jsx)("div",{className:"p-4",children:i})]})})]}):null}function i(e){let{isOpen:a,onClose:n,onConfirm:s,title:i,message:r,confirmText:l="Confirm",cancelText:c="Cancel",variant:d="danger"}=e;return(0,t.jsxs)(o,{isOpen:a,onClose:n,title:i,children:[(0,t.jsx)("p",{className:"text-gray-300 mb-6",children:r}),(0,t.jsxs)("div",{className:"flex gap-3 justify-end",children:[(0,t.jsx)("button",{onClick:n,className:"px-4 py-2 bg-[#2a2a2a] hover:bg-[#333] rounded-lg transition-colors text-gray-300",children:c}),(0,t.jsx)("button",{onClick:()=>{s(),n()},className:"px-4 py-2 ".concat("danger"===d?"bg-red-500 hover:bg-red-600":"warning"===d?"bg-yellow-500 hover:bg-yellow-600":"bg-blue-500 hover:bg-blue-600"," rounded-lg transition-colors text-white font-medium"),children:l})]})]})}var r=e.i(2971),l=e.i(22140),c=e.i(75254);let d=(0,c.default)("send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]);function g(e){let{value:a,disabled:n,messagesEndRef:s,onChange:o,onSend:i}=e;return(0,t.jsx)("div",{className:"sticky bottom-0 z-40 bg-[#0f0f0f] border-t border-[#2a2a2a] py-3 px-4",children:(0,t.jsxs)("div",{className:"max-w-4xl mx-auto flex gap-3 items-center",children:[(0,t.jsxs)("div",{className:"flex-1 relative inline-block",children:[(0,t.jsx)("textarea",{value:a,onChange:e=>o(e.target.value),onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),i())},onFocus:()=>{setTimeout(()=>{var e;null==(e=s.current)||e.scrollIntoView({behavior:"smooth"})},300)},placeholder:"Type your message...",className:"w-full resize-none bg-[#1a1a1a] border border-[#2a2a2a] text-gray-100 placeholder-gray-500 rounded-xl px-4 pr-16 py-3 focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-transparent transition-all leading-tight block",rows:1,disabled:n}),(0,t.jsx)("div",{className:"hidden md:block pointer-events-none absolute right-3 bottom-3 text-xs text-gray-500 px-2 py-0.5 rounded-md ".concat(a?"opacity-0":"opacity-100"," transition-opacity bg-[#0f0f0f]"),children:"(Shift+Enter for new line)"})]}),(0,t.jsx)("button",{onClick:i,disabled:!a.trim()||n,className:"px-6 py-3 bg-red-500 text-white rounded-xl hover:bg-red-600 disabled:bg-gray-700 disabled:text-gray-500 disabled:cursor-not-allowed transition-all flex items-center gap-2 font-medium shadow-lg",children:(0,t.jsx)(d,{size:20})})]})})}var u=e.i(86311);let m=(0,c.default)("brain",[["path",{d:"M12 18V5",key:"adv99a"}],["path",{d:"M15 13a4.17 4.17 0 0 1-3-4 4.17 4.17 0 0 1-3 4",key:"1e3is1"}],["path",{d:"M17.598 6.5A3 3 0 1 0 12 5a3 3 0 1 0-5.598 1.5",key:"1gqd8o"}],["path",{d:"M17.997 5.125a4 4 0 0 1 2.526 5.77",key:"iwvgf7"}],["path",{d:"M18 18a4 4 0 0 0 2-7.464",key:"efp6ie"}],["path",{d:"M19.967 17.483A4 4 0 1 1 12 18a4 4 0 1 1-7.967-.517",key:"1gq6am"}],["path",{d:"M6 18a4 4 0 0 1-2-7.464",key:"k1g0md"}],["path",{d:"M6.003 5.125a4 4 0 0 0-2.526 5.77",key:"q97ue3"}]]);function h(e){let{messages:a,thinking:n,isLoading:s,isStreaming:o,streamingMessageId:i,skeletonShrinking:r,messagesEndRef:l,conversationId:c}=e;return(0,t.jsxs)("div",{className:"flex-1 overflow-y-auto pt-6 pb-6 px-6 space-y-6",children:[!(null==a?void 0:a.length)&&!s&&(0,t.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,t.jsxs)("div",{className:"text-center text-gray-500",children:[(0,t.jsx)(u.MessageSquare,{size:48,className:"mx-auto mb-4 opacity-20"}),(0,t.jsx)("p",{className:"text-lg font-medium",children:"Start a conversation"}),(0,t.jsx)("p",{className:"text-sm mt-2",children:"Send a message to begin chatting with Red AI"})]})}),null==a?void 0:a.map(e=>{let a="assistant"===e.role?n[e.id]:null;return(0,t.jsx)(v,{message:e,thinking:a||null,isStreaming:o&&i===e.id},e.id)}),s&&(0,t.jsx)("div",{className:"flex justify-start",children:(0,t.jsx)("div",{className:"bg-[#1a1a1a] border border-[#2a2a2a] rounded-xl px-5 py-3.5 shadow-lg",children:(0,t.jsx)("div",{className:"w-48 h-4 rounded skeleton ".concat(r?"shrinking":"")})})}),(0,t.jsx)("div",{ref:l})]})}function v(e){let{message:n,thinking:s,isStreaming:o}=e,[i,r]=(0,a.useState)(!1);return(0,t.jsx)("div",{className:"flex ".concat("user"===n.role?"justify-end":"justify-start"),children:(0,t.jsxs)("div",{className:"max-w-[80%] rounded-xl px-5 py-3.5 shadow-lg ".concat("user"===n.role?"bg-[#1a1a1a] border border-[#2a2a2a] text-gray-100":"bg-red-500 text-white ".concat(o?"streaming-pulse":"")),children:[(0,t.jsx)("p",{className:"whitespace-pre-wrap",children:n.content}),s&&"assistant"===n.role&&(0,t.jsxs)("div",{className:"mt-3 pt-3 border-t border-white/20",children:[(0,t.jsxs)("button",{onClick:()=>r(!i),className:"flex items-center gap-2 text-sm opacity-80 hover:opacity-100 transition-opacity",children:[(0,t.jsx)(m,{size:16}),(0,t.jsxs)("span",{children:[i?"Hide":"Show"," thinking"]})]}),i&&(0,t.jsxs)("div",{className:"mt-3 p-3 bg-black/20 rounded-lg text-sm",children:[(0,t.jsx)("div",{className:"font-semibold mb-2 opacity-70",children:"Reasoning:"}),(0,t.jsx)("p",{className:"whitespace-pre-wrap opacity-90",children:s})]})]})]})})}function f(){let[e,s]=(0,a.useState)([]),[o,c]=(0,a.useState)(null),[d,u]=(0,a.useState)(""),[m,v]=(0,a.useState)(!1),[f,x]=(0,a.useState)(!1),[p,y]=(0,a.useState)(!1),[b,S]=(0,a.useState)(null),[j,w]=(0,a.useState)({}),[N,k]=(0,a.useState)(!1),[C,T]=(0,a.useState)(!1),[A,E]=(0,a.useState)(null),[I,M]=(0,a.useState)(null),[O,D]=(0,a.useState)(""),P=(0,a.useRef)(null),z=e.find(e=>e.id===o);(0,a.useEffect)(()=>{let e=n.conversationStorage.getAll();s(e);let t=n.conversationStorage.getActiveId();t&&e.some(e=>e.id===t)?c(t):e.length>0&&(c(e[0].id),n.conversationStorage.setActiveId(e[0].id))},[]),(0,a.useEffect)(()=>{var e;null==(e=P.current)||e.scrollIntoView({behavior:"smooth"})},[null==z?void 0:z.messages]);let R=()=>{let e=n.conversationStorage.create();s(t=>[e,...t]),c(e.id),n.conversationStorage.setActiveId(e.id),k(!1)},F=async e=>{try{let t=await fetch("/api/v1/conversations/".concat(e,"/title"));if(t.ok){let a=await t.json();if(a.title){let t=n.conversationStorage.get(e);t&&!t.titleSetByUser&&(t.title=a.title,n.conversationStorage.save(t),s(n.conversationStorage.getAll()))}}}catch(e){console.error("Error fetching conversation title:",e)}},U=async(e,t)=>{try{if((await fetch("/api/v1/conversations/".concat(e,"/title"),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:t})})).ok){let a=n.conversationStorage.get(e);a&&(a.title=t,a.titleSetByUser=!0,n.conversationStorage.save(a),s(n.conversationStorage.getAll()))}}catch(e){console.error("Error updating conversation title:",e)}},V=async e=>{O.trim()&&await U(e,O.trim()),M(null),D("")},_=async(e,t,a)=>{let o={id:t,role:"assistant",content:"",timestamp:Date.now()},i=!1,r=!1,l=!1,c=[],d=!1,g="",u=()=>{l||(l=!0,x(!0),y(!0),S(t),setTimeout(()=>{v(!1),x(!1),r=!0},400))},m=async()=>{if(!d){if(!r)return void setTimeout(()=>m(),50);for(d=!0;c.length>0;){let a=c.shift();if(a){if(o.content=g+=a,!i&&g.trim()){let t=n.conversationStorage.get(e);t&&(t.messages.push(o),n.conversationStorage.save(t),s(n.conversationStorage.getAll()),i=!0,setTimeout(()=>{var e;null==(e=P.current)||e.scrollIntoView({behavior:"smooth"})},50))}else if(i){let a=n.conversationStorage.get(e);if(a){let e=a.messages.findIndex(e=>e.id===t);e>=0&&(a.messages[e]={...o},a.updatedAt=Date.now(),n.conversationStorage.save(a),s(n.conversationStorage.getAll()))}}await new Promise(e=>setTimeout(e,10))}}d=!1}};try{var h;let s=await fetch(a);if(!s.ok)throw Error("Failed to connect to stream");let r=null==(h=s.body)?void 0:h.getReader(),v=new TextDecoder;if(r){for(;;){let{done:e,value:a}=await r.read();if(e)break;for(let e of v.decode(a).split("\n"))if(e.startsWith("data: ")){let a=e.slice(6);if("[DONE]"===a)continue;try{let e=JSON.parse(a);if("content"===e.type&&e.content){l||u();let t=e.content.split("");c.push(...t),d||m()}else if("thinking"===e.type&&e.content)w(a=>({...a,[t]:(a[t]||"")+e.content}));else if("complete"===e.type)console.log("[Stream] Generation complete");else if("error"===e.type)throw console.error("[Stream] Error:",e.error),Error(e.error)}catch(e){if(e instanceof SyntaxError)continue;throw e}}}for(;c.length>0||d;)await new Promise(e=>setTimeout(e,50));if(g.trim()&&!i){let t=n.conversationStorage.get(e);t&&(t.messages.push(o),n.conversationStorage.save(t))}}}finally{v(!1),x(!1),y(!1),S(null)}},q=async()=>{if(!d.trim()||m)return;let e=o;if(!e){let t=n.conversationStorage.create();s(e=>[t,...e]),c(e=t.id),n.conversationStorage.setActiveId(e)}let t={id:"msg_".concat(Date.now(),"_user"),role:"user",content:d.trim(),timestamp:Date.now()};n.conversationStorage.addMessage(e,t),s(n.conversationStorage.getAll()),u(""),v(!0);try{let a=await fetch("/api/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({model:"Red",messages:[{role:"user",content:t.content}],stream:!0,conversationId:e})});if(!a.ok)throw Error("Failed to start generation");let s=await a.json(),o=s.id,i=s.stream_url;console.log("[Send] Got messageId:",o,"stream at:",i),await _(e,o,i);let r=n.conversationStorage.get(e),l=(null==r?void 0:r.messages.length)||0;(2===l||6===l)&&setTimeout(()=>F(e),1500)}catch(e){console.error("Error sending message:",e),alert("Failed to send message. Please try again."),v(!1),x(!1)}};return(0,t.jsxs)("div",{className:"flex bg-[#0a0a0a]",style:{height:"calc(var(--vh, 1vh) * 100)"},children:[(0,t.jsx)(l.Sidebar,{isOpen:N,conversations:e,activeConversationId:o,editingTitleId:I,editingTitleValue:O,onClose:()=>k(!1),onNewChat:R,onSwitchConversation:e=>{c(e),n.conversationStorage.setActiveId(e),k(!1)},onDeleteClick:(e,t)=>{t.stopPropagation(),E(e),T(!0)},onStartEditingTitle:(e,t)=>{t.stopPropagation(),M(e.id),D(e.title)},onSaveEditedTitle:V,onCancelEditingTitle:()=>{M(null),D("")},onEditingTitleChange:D}),(0,t.jsxs)("div",{className:"flex-1 flex flex-col",children:[(0,t.jsx)(r.Header,{title:(null==z?void 0:z.title)||"Chat",onMenuClick:()=>k(!N),onNewChat:R}),(0,t.jsx)(h,{messages:null==z?void 0:z.messages,thinking:j,isLoading:m,isStreaming:p,streamingMessageId:b,skeletonShrinking:f,messagesEndRef:P,conversationId:null==z?void 0:z.id}),(0,t.jsx)(g,{value:d,disabled:m,messagesEndRef:P,onChange:u,onSend:q})]}),(0,t.jsx)(i,{isOpen:C,onClose:()=>T(!1),onConfirm:()=>{if(!A)return;n.conversationStorage.delete(A);let e=n.conversationStorage.getAll();s(e),A===o&&(e.length>0?(c(e[0].id),n.conversationStorage.setActiveId(e[0].id)):c(null)),E(null)},title:"Delete Conversation",message:"Are you sure you want to delete this conversation? This action cannot be undone.",confirmText:"Delete",cancelText:"Cancel",variant:"danger"})]})}}]);