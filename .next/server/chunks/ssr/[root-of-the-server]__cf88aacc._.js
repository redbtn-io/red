module.exports=[56704,(a,b,c)=>{b.exports=a.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},32319,(a,b,c)=>{b.exports=a.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},20635,(a,b,c)=>{b.exports=a.x("next/dist/server/app-render/action-async-storage.external.js",()=>require("next/dist/server/app-render/action-async-storage.external.js"))},87924,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored["react-ssr"].ReactJsxRuntime},35112,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored["react-ssr"].ReactDOM},9270,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored.contexts.AppRouterContext},38783,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored["react-ssr"].ReactServerDOMTurbopackClient},36313,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored.contexts.HooksClientContext},18341,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored.contexts.ServerInsertedHtml},51234,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"HandleISRError",{enumerable:!0,get:function(){return e}});let d=a.r(56704).workAsyncStorage;function e(a){let{error:b}=a;if(d){let a=d.getStore();if((null==a?void 0:a.isRevalidate)||(null==a?void 0:a.isStaticGeneration))throw console.error(b),b}return null}("function"==typeof c.default||"object"==typeof c.default&&null!==c.default)&&void 0===c.default.__esModule&&(Object.defineProperty(c.default,"__esModule",{value:!0}),Object.assign(c.default,c),b.exports=c.default)},40622,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"default",{enumerable:!0,get:function(){return g}});let d=a.r(87924),e=a.r(51234),f={error:{fontFamily:'system-ui,"Segoe UI",Roboto,Helvetica,Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji"',height:"100vh",textAlign:"center",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},text:{fontSize:"14px",fontWeight:400,lineHeight:"28px",margin:"0 8px"}},g=function(a){let{error:b}=a,c=null==b?void 0:b.digest;return(0,d.jsxs)("html",{id:"__next_error__",children:[(0,d.jsx)("head",{}),(0,d.jsxs)("body",{children:[(0,d.jsx)(e.HandleISRError,{error:b}),(0,d.jsx)("div",{style:f.error,children:(0,d.jsxs)("div",{children:[(0,d.jsxs)("h2",{style:f.text,children:["Application error: a ",c?"server":"client","-side exception has occurred while loading ",window.location.hostname," (see the"," ",c?"server logs":"browser console"," for more information)."]}),c?(0,d.jsx)("p",{style:f.text,children:"Digest: "+c}):null]})})]})]})};("function"==typeof c.default||"object"==typeof c.default&&null!==c.default)&&void 0===c.default.__esModule&&(Object.defineProperty(c.default,"__esModule",{value:!0}),Object.assign(c.default,c),b.exports=c.default)},40777,a=>{"use strict";a.s(["default",()=>q],40777);var b=a.i(87924),c=a.i(72131),d=a.i(26988),e=a.i(33508);function f({isOpen:a,onClose:c,title:d,children:f}){return a?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50",onClick:c}),(0,b.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:(0,b.jsxs)("div",{className:"bg-[#1a1a1a] border border-[#2a2a2a] rounded-xl max-w-md w-full shadow-2xl",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between p-4 border-b border-[#2a2a2a]",children:[(0,b.jsx)("h2",{className:"text-lg font-semibold text-gray-100",children:d}),(0,b.jsx)("button",{onClick:c,className:"p-1 hover:bg-[#2a2a2a] rounded-lg transition-colors text-gray-400 hover:text-gray-200",children:(0,b.jsx)(e.X,{size:20})})]}),(0,b.jsx)("div",{className:"p-4",children:f})]})})]}):null}function g({isOpen:a,onClose:c,onConfirm:d,title:e,message:g,confirmText:h="Confirm",cancelText:i="Cancel",variant:j="danger"}){return(0,b.jsxs)(f,{isOpen:a,onClose:c,title:e,children:[(0,b.jsx)("p",{className:"text-gray-300 mb-6",children:g}),(0,b.jsxs)("div",{className:"flex gap-3 justify-end",children:[(0,b.jsx)("button",{onClick:c,className:"px-4 py-2 bg-[#2a2a2a] hover:bg-[#333] rounded-lg transition-colors text-gray-300",children:i}),(0,b.jsx)("button",{onClick:()=>{d(),c()},className:`px-4 py-2 ${"danger"===j?"bg-red-500 hover:bg-red-600":"warning"===j?"bg-yellow-500 hover:bg-yellow-600":"bg-blue-500 hover:bg-blue-600"} rounded-lg transition-colors text-white font-medium`,children:h})]})]})}var h=a.i(20238),i=a.i(45209),j=a.i(70106);let k=(0,j.default)("send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]);function l({value:a,disabled:c,messagesEndRef:d,onChange:e,onSend:f}){return(0,b.jsx)("div",{className:"sticky bottom-0 z-40 bg-[#0f0f0f] border-t border-[#2a2a2a] py-3 px-4",children:(0,b.jsxs)("div",{className:"max-w-4xl mx-auto flex gap-3 items-center",children:[(0,b.jsxs)("div",{className:"flex-1 relative inline-block",children:[(0,b.jsx)("textarea",{value:a,onChange:a=>e(a.target.value),onKeyDown:a=>{"Enter"!==a.key||a.shiftKey||(a.preventDefault(),f())},onFocus:()=>{setTimeout(()=>{d.current?.scrollIntoView({behavior:"smooth"})},300)},placeholder:"Type your message...",className:"w-full resize-none bg-[#1a1a1a] border border-[#2a2a2a] text-gray-100 placeholder-gray-500 rounded-xl px-4 pr-16 py-3 focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-transparent transition-all leading-tight block",rows:1,disabled:c}),(0,b.jsx)("div",{className:`hidden md:block pointer-events-none absolute right-3 bottom-3 text-xs text-gray-500 px-2 py-0.5 rounded-md ${a?"opacity-0":"opacity-100"} transition-opacity bg-[#0f0f0f]`,children:"(Shift+Enter for new line)"})]}),(0,b.jsx)("button",{onClick:f,disabled:!a.trim()||c,className:"px-6 py-3 bg-red-500 text-white rounded-xl hover:bg-red-600 disabled:bg-gray-700 disabled:text-gray-500 disabled:cursor-not-allowed transition-all flex items-center gap-2 font-medium shadow-lg",children:(0,b.jsx)(k,{size:20})})]})})}var m=a.i(63588);let n=(0,j.default)("brain",[["path",{d:"M12 18V5",key:"adv99a"}],["path",{d:"M15 13a4.17 4.17 0 0 1-3-4 4.17 4.17 0 0 1-3 4",key:"1e3is1"}],["path",{d:"M17.598 6.5A3 3 0 1 0 12 5a3 3 0 1 0-5.598 1.5",key:"1gqd8o"}],["path",{d:"M17.997 5.125a4 4 0 0 1 2.526 5.77",key:"iwvgf7"}],["path",{d:"M18 18a4 4 0 0 0 2-7.464",key:"efp6ie"}],["path",{d:"M19.967 17.483A4 4 0 1 1 12 18a4 4 0 1 1-7.967-.517",key:"1gq6am"}],["path",{d:"M6 18a4 4 0 0 1-2-7.464",key:"k1g0md"}],["path",{d:"M6.003 5.125a4 4 0 0 0-2.526 5.77",key:"q97ue3"}]]);function o({messages:a,thinking:c,isLoading:d,isStreaming:e,streamingMessageId:f,skeletonShrinking:g,messagesEndRef:h,conversationId:i}){return(0,b.jsxs)("div",{className:"flex-1 overflow-y-auto pt-6 pb-6 px-6 space-y-6",children:[!a?.length&&!d&&(0,b.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,b.jsxs)("div",{className:"text-center text-gray-500",children:[(0,b.jsx)(m.MessageSquare,{size:48,className:"mx-auto mb-4 opacity-20"}),(0,b.jsx)("p",{className:"text-lg font-medium",children:"Start a conversation"}),(0,b.jsx)("p",{className:"text-sm mt-2",children:"Send a message to begin chatting with Red AI"})]})}),a?.map(a=>{let d="assistant"===a.role?c[a.id]:null;return(0,b.jsx)(p,{message:a,thinking:d||null,isStreaming:e&&f===a.id},a.id)}),d&&(0,b.jsx)("div",{className:"flex justify-start",children:(0,b.jsx)("div",{className:"bg-[#1a1a1a] border border-[#2a2a2a] rounded-xl px-5 py-3.5 shadow-lg",children:(0,b.jsx)("div",{className:`w-48 h-4 rounded skeleton ${g?"shrinking":""}`})})}),(0,b.jsx)("div",{ref:h})]})}function p({message:a,thinking:d,isStreaming:e}){let[f,g]=(0,c.useState)(!1);return(0,b.jsx)("div",{className:`flex ${"user"===a.role?"justify-end":"justify-start"}`,children:(0,b.jsxs)("div",{className:`max-w-[80%] rounded-xl px-5 py-3.5 shadow-lg ${"user"===a.role?"bg-[#1a1a1a] border border-[#2a2a2a] text-gray-100":`bg-red-500 text-white ${e?"streaming-pulse":""}`}`,children:[(0,b.jsx)("p",{className:"whitespace-pre-wrap",children:a.content}),d&&"assistant"===a.role&&(0,b.jsxs)("div",{className:"mt-3 pt-3 border-t border-white/20",children:[(0,b.jsxs)("button",{onClick:()=>g(!f),className:"flex items-center gap-2 text-sm opacity-80 hover:opacity-100 transition-opacity",children:[(0,b.jsx)(n,{size:16}),(0,b.jsxs)("span",{children:[f?"Hide":"Show"," thinking"]})]}),f&&(0,b.jsxs)("div",{className:"mt-3 p-3 bg-black/20 rounded-lg text-sm",children:[(0,b.jsx)("div",{className:"font-semibold mb-2 opacity-70",children:"Reasoning:"}),(0,b.jsx)("p",{className:"whitespace-pre-wrap opacity-90",children:d})]})]})]})})}function q(){let[a,e]=(0,c.useState)([]),[f,j]=(0,c.useState)(null),[k,m]=(0,c.useState)(""),[n,p]=(0,c.useState)(!1),[q,r]=(0,c.useState)(!1),[s,t]=(0,c.useState)(!1),[u,v]=(0,c.useState)(null),[w,x]=(0,c.useState)({}),[y,z]=(0,c.useState)(!1),[A,B]=(0,c.useState)(!1),[C,D]=(0,c.useState)(null),[E,F]=(0,c.useState)(null),[G,H]=(0,c.useState)(""),I=(0,c.useRef)(null),J=a.find(a=>a.id===f);(0,c.useEffect)(()=>{let a=d.conversationStorage.getAll();e(a);let b=d.conversationStorage.getActiveId();b&&a.some(a=>a.id===b)?j(b):a.length>0&&(j(a[0].id),d.conversationStorage.setActiveId(a[0].id))},[]),(0,c.useEffect)(()=>{I.current?.scrollIntoView({behavior:"smooth"})},[J?.messages]);let K=()=>{let a=d.conversationStorage.create();e(b=>[a,...b]),j(a.id),d.conversationStorage.setActiveId(a.id),z(!1)},L=async a=>{try{let b=await fetch(`/api/v1/conversations/${a}/title`);if(b.ok){let c=await b.json();if(c.title){let b=d.conversationStorage.get(a);b&&!b.titleSetByUser&&(b.title=c.title,d.conversationStorage.save(b),e(d.conversationStorage.getAll()))}}}catch(a){console.error("Error fetching conversation title:",a)}},M=async(a,b)=>{try{if((await fetch(`/api/v1/conversations/${a}/title`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:b})})).ok){let c=d.conversationStorage.get(a);c&&(c.title=b,c.titleSetByUser=!0,d.conversationStorage.save(c),e(d.conversationStorage.getAll()))}}catch(a){console.error("Error updating conversation title:",a)}},N=async a=>{G.trim()&&await M(a,G.trim()),F(null),H("")},O=async(a,b,c)=>{let f={id:b,role:"assistant",content:"",timestamp:Date.now()},g=!1,h=!1,i=!1,j=[],k=!1,l="",m=()=>{i||(i=!0,r(!0),t(!0),v(b),setTimeout(()=>{p(!1),r(!1),h=!0},400))},n=async()=>{if(!k){if(!h)return void setTimeout(()=>n(),50);for(k=!0;j.length>0;){let c=j.shift();if(c){if(f.content=l+=c,!g&&l.trim()){let b=d.conversationStorage.get(a);b&&(b.messages.push(f),d.conversationStorage.save(b),e(d.conversationStorage.getAll()),g=!0,setTimeout(()=>{I.current?.scrollIntoView({behavior:"smooth"})},50))}else if(g){let c=d.conversationStorage.get(a);if(c){let a=c.messages.findIndex(a=>a.id===b);a>=0&&(c.messages[a]={...f},c.updatedAt=Date.now(),d.conversationStorage.save(c),e(d.conversationStorage.getAll()))}}await new Promise(a=>setTimeout(a,10))}}k=!1}};try{let e=await fetch(c);if(!e.ok)throw Error("Failed to connect to stream");let h=e.body?.getReader(),o=new TextDecoder;if(h){for(;;){let{done:a,value:c}=await h.read();if(a)break;for(let a of o.decode(c).split("\n"))if(a.startsWith("data: ")){let c=a.slice(6);if("[DONE]"===c)continue;try{let a=JSON.parse(c);if("content"===a.type&&a.content){i||m();let b=a.content.split("");j.push(...b),k||n()}else if("thinking"===a.type&&a.content)x(c=>({...c,[b]:(c[b]||"")+a.content}));else if("complete"===a.type)console.log("[Stream] Generation complete");else if("error"===a.type)throw console.error("[Stream] Error:",a.error),Error(a.error)}catch(a){if(a instanceof SyntaxError)continue;throw a}}}for(;j.length>0||k;)await new Promise(a=>setTimeout(a,50));if(l.trim()&&!g){let b=d.conversationStorage.get(a);b&&(b.messages.push(f),d.conversationStorage.save(b))}}}finally{p(!1),r(!1),t(!1),v(null)}},P=async()=>{if(!k.trim()||n)return;let a=f;if(!a){let b=d.conversationStorage.create();e(a=>[b,...a]),j(a=b.id),d.conversationStorage.setActiveId(a)}let b={id:`msg_${Date.now()}_user`,role:"user",content:k.trim(),timestamp:Date.now()};d.conversationStorage.addMessage(a,b),e(d.conversationStorage.getAll()),m(""),p(!0);try{let c=await fetch("/api/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({model:"Red",messages:[{role:"user",content:b.content}],stream:!0,conversationId:a})});if(!c.ok)throw Error("Failed to start generation");let e=await c.json(),f=e.id,g=e.stream_url;console.log("[Send] Got messageId:",f,"stream at:",g),await O(a,f,g);let h=d.conversationStorage.get(a),i=h?.messages.length||0;(2===i||6===i)&&setTimeout(()=>L(a),1500)}catch(a){console.error("Error sending message:",a),alert("Failed to send message. Please try again."),p(!1),r(!1)}};return(0,b.jsxs)("div",{className:"flex bg-[#0a0a0a]",style:{height:"calc(var(--vh, 1vh) * 100)"},children:[(0,b.jsx)(i.Sidebar,{isOpen:y,conversations:a,activeConversationId:f,editingTitleId:E,editingTitleValue:G,onClose:()=>z(!1),onNewChat:K,onSwitchConversation:a=>{j(a),d.conversationStorage.setActiveId(a),z(!1)},onDeleteClick:(a,b)=>{b.stopPropagation(),D(a),B(!0)},onStartEditingTitle:(a,b)=>{b.stopPropagation(),F(a.id),H(a.title)},onSaveEditedTitle:N,onCancelEditingTitle:()=>{F(null),H("")},onEditingTitleChange:H}),(0,b.jsxs)("div",{className:"flex-1 flex flex-col",children:[(0,b.jsx)(h.Header,{title:J?.title||"Chat",onMenuClick:()=>z(!y),onNewChat:K}),(0,b.jsx)(o,{messages:J?.messages,thinking:w,isLoading:n,isStreaming:s,streamingMessageId:u,skeletonShrinking:q,messagesEndRef:I,conversationId:J?.id}),(0,b.jsx)(l,{value:k,disabled:n,messagesEndRef:I,onChange:m,onSend:P})]}),(0,b.jsx)(g,{isOpen:A,onClose:()=>B(!1),onConfirm:()=>{if(!C)return;d.conversationStorage.delete(C);let a=d.conversationStorage.getAll();e(a),C===f&&(a.length>0?(j(a[0].id),d.conversationStorage.setActiveId(a[0].id)):j(null)),D(null)},title:"Delete Conversation",message:"Are you sure you want to delete this conversation? This action cannot be undone.",confirmText:"Delete",cancelText:"Cancel",variant:"danger"})]})}}];

//# sourceMappingURL=%5Broot-of-the-server%5D__cf88aacc._.js.map