module.exports=[14747,(e,t,n)=>{t.exports=e.x("path",()=>require("path"))},24361,(e,t,n)=>{t.exports=e.x("util",()=>require("util"))},18622,(e,t,n)=>{t.exports=e.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},56704,(e,t,n)=>{t.exports=e.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},32319,(e,t,n)=>{t.exports=e.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},70406,(e,t,n)=>{t.exports=e.x("next/dist/compiled/@opentelemetry/api",()=>require("next/dist/compiled/@opentelemetry/api"))},93695,(e,t,n)=>{t.exports=e.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},54799,(e,t,n)=>{t.exports=e.x("crypto",()=>require("crypto"))},81769,(e,t,n)=>{t.exports=e.x("mongodb",()=>require("mongodb"))},79334,(e,t,n)=>{"use strict";var i=e.e&&e.e.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(r,o){function s(e){try{l(i.next(e))}catch(e){o(e)}}function a(e){try{l(i.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?r(e.value):((t=e.value)instanceof n?t:new n(function(e){e(t)})).then(s,a)}l((i=i.apply(e,t||[])).next())})};Object.defineProperty(n,"__esModule",{value:!0}),n.DatabaseManager=void 0,n.getDatabase=function(e,t){if(!s){let n=process.env.MONGODB_URI||process.env.MONGODB_URL||"mongodb://localhost:27017",i=e||n,r=t;if(!r){let e=i.match(/\/([^/?]+)(\?|$)/);r=e&&e[1]?e[1]:process.env.MONGODB_NAME||"redbtn_ai"}s=new o(i,r)}return s},n.resetDatabase=function(){s=null};let r=e.r(81769);class o{constructor(e="mongodb://localhost:27017",t="redbtn_ai"){this.mongoUrl=e,this.dbName=t,this.client=null,this.db=null,this.collections=new Map,this.connectionPromise=null,this.COLLECTIONS={MESSAGES:"messages",CONVERSATIONS:"conversations",LOGS:"logs",GENERATIONS:"generations",THOUGHTS:"thoughts"}}connect(){return i(this,void 0,void 0,function*(){return this.connectionPromise||(this.connectionPromise=i(this,void 0,void 0,function*(){try{console.log("[Database] Connecting to MongoDB..."),this.mongoUrl.includes("@"),this.client=new r.MongoClient(this.mongoUrl,{serverSelectionTimeoutMS:5e3,connectTimeoutMS:1e4}),yield this.client.connect(),yield this.client.db("admin").admin().ping(),this.db=this.client.db(this.dbName),yield this.initializeCollections(),console.log("[Database] Connected to MongoDB successfully")}catch(e){throw console.error("[Database] Failed to connect to MongoDB:",e),console.error("[Database] Make sure MongoDB is running and authentication is configured correctly"),console.error("[Database] Current connection string:",this.mongoUrl.replace(/\/\/([^:]+):([^@]+)@/,"//$1:****@")),this.connectionPromise=null,e}})),this.connectionPromise})}initializeCollections(){return i(this,void 0,void 0,function*(){if(!this.db)throw Error("Database not connected");let e=this.db.collection(this.COLLECTIONS.MESSAGES);yield e.createIndex({conversationId:1,timestamp:1}),yield e.createIndex({timestamp:-1}),this.collections.set(this.COLLECTIONS.MESSAGES,e);let t=this.db.collection(this.COLLECTIONS.CONVERSATIONS);yield t.createIndex({conversationId:1},{unique:!0}),yield t.createIndex({updatedAt:-1}),yield t.createIndex({userId:1}),this.collections.set(this.COLLECTIONS.CONVERSATIONS,t);let n=this.db.collection(this.COLLECTIONS.LOGS);yield n.createIndex({timestamp:-1}),yield n.createIndex({generationId:1}),yield n.createIndex({conversationId:1}),yield n.createIndex({level:1}),yield n.createIndex({category:1}),yield n.createIndex({logId:1},{unique:!0}),yield n.createIndex({timestamp:1},{expireAfterSeconds:15552e3}),this.collections.set(this.COLLECTIONS.LOGS,n);let i=this.db.collection(this.COLLECTIONS.GENERATIONS);yield i.createIndex({generationId:1},{unique:!0}),yield i.createIndex({conversationId:1}),yield i.createIndex({status:1}),yield i.createIndex({startTime:-1}),yield i.createIndex({nodeId:1}),this.collections.set(this.COLLECTIONS.GENERATIONS,i);let r=this.db.collection(this.COLLECTIONS.THOUGHTS);yield r.createIndex({thoughtId:1},{unique:!0}),yield r.createIndex({conversationId:1}),yield r.createIndex({messageId:1}),yield r.createIndex({generationId:1}),yield r.createIndex({timestamp:-1}),yield r.createIndex({source:1}),this.collections.set(this.COLLECTIONS.THOUGHTS,r)})}ensureConnected(){return i(this,void 0,void 0,function*(){this.db&&0!==this.collections.size||(yield this.connect())})}getCollection(e){let t=this.collections.get(e);if(!t)throw Error(`Collection ${e} not initialized`);return t}collection(e){return i(this,void 0,void 0,function*(){if(yield this.ensureConnected(),!this.collections.has(e)){let t=this.db.collection(e);this.collections.set(e,t)}return this.getCollection(e)})}insertOne(e,t){return i(this,void 0,void 0,function*(){yield this.ensureConnected();let n=yield this.collection(e),i=Object.assign(Object.assign({},t),{createdAt:t.createdAt||new Date,updatedAt:t.updatedAt||new Date});return(yield n.insertOne(i)).insertedId})}insertMany(e,t){return i(this,void 0,void 0,function*(){if(0===t.length)return[];yield this.ensureConnected();let n=yield this.collection(e),i=t.map(e=>Object.assign(Object.assign({},e),{createdAt:e.createdAt||new Date,updatedAt:e.updatedAt||new Date}));return Object.values((yield n.insertMany(i)).insertedIds)})}find(e){return i(this,arguments,void 0,function*(e,t={},n){yield this.ensureConnected();let i=yield this.collection(e);return yield i.find(t,n).toArray()})}findOne(e,t){return i(this,void 0,void 0,function*(){yield this.ensureConnected();let n=yield this.collection(e);return yield n.findOne(t)})}updateMany(e,t,n){return i(this,void 0,void 0,function*(){yield this.ensureConnected();let i=yield this.collection(e),r=Object.assign(Object.assign({},n),{$set:Object.assign(Object.assign({},n.$set||{}),{updatedAt:new Date})});return(yield i.updateMany(t,r)).modifiedCount})}updateOne(e,t,n){return i(this,arguments,void 0,function*(e,t,n,i=!1){yield this.ensureConnected();let r=yield this.collection(e),o=Object.assign(Object.assign({},n),{$set:Object.assign(Object.assign({},n.$set||{}),{updatedAt:new Date}),$setOnInsert:Object.assign(Object.assign({},n.$setOnInsert||{}),{createdAt:new Date})}),s=yield r.updateOne(t,o,{upsert:i});return s.modifiedCount>0||i&&s.upsertedCount>0})}deleteMany(e,t){return i(this,void 0,void 0,function*(){yield this.ensureConnected();let n=yield this.collection(e);return(yield n.deleteMany(t)).deletedCount})}deleteOne(e,t){return i(this,void 0,void 0,function*(){yield this.ensureConnected();let n=yield this.collection(e);return(yield n.deleteOne(t)).deletedCount>0})}count(e){return i(this,arguments,void 0,function*(e,t={}){yield this.ensureConnected();let n=yield this.collection(e);return yield n.countDocuments(t)})}storeMessage(e){return i(this,void 0,void 0,function*(){yield this.ensureConnected();let t=this.getCollection(this.COLLECTIONS.MESSAGES),n=yield t.insertOne(Object.assign(Object.assign({},e),{createdAt:new Date,updatedAt:new Date})),i=this.getCollection(this.COLLECTIONS.CONVERSATIONS);return yield i.updateOne({conversationId:e.conversationId},{$set:{updatedAt:new Date},$inc:{"metadata.messageCount":1}},{upsert:!0}),n.insertedId})}storeMessages(e){return i(this,void 0,void 0,function*(){if(0===e.length)return;yield this.ensureConnected();let t=this.getCollection(this.COLLECTIONS.MESSAGES);yield t.insertMany(e.map(e=>Object.assign(Object.assign({},e),{createdAt:new Date,updatedAt:new Date})));let n=e[0].conversationId,i=this.getCollection(this.COLLECTIONS.CONVERSATIONS);yield i.updateOne({conversationId:n},{$set:{updatedAt:new Date},$inc:{"metadata.messageCount":e.length}},{upsert:!0})})}getMessages(e){return i(this,arguments,void 0,function*(e,t=0,n=0){yield this.ensureConnected();let i=this.getCollection(this.COLLECTIONS.MESSAGES).find({conversationId:e}).sort({timestamp:1}).skip(n);return t>0&&i.limit(t),yield i.toArray()})}getLastMessages(e,t){return i(this,void 0,void 0,function*(){yield this.ensureConnected();let n=this.getCollection(this.COLLECTIONS.MESSAGES);return(yield n.find({conversationId:e}).sort({timestamp:-1}).limit(t).toArray()).reverse()})}getMessageCount(e){return i(this,void 0,void 0,function*(){yield this.ensureConnected();let t=this.getCollection(this.COLLECTIONS.MESSAGES);return yield t.countDocuments({conversationId:e})})}upsertConversation(e){return i(this,void 0,void 0,function*(){yield this.ensureConnected();let t=this.getCollection(this.COLLECTIONS.CONVERSATIONS);yield t.updateOne({conversationId:e.conversationId},{$set:Object.assign(Object.assign({},e),{updatedAt:new Date}),$setOnInsert:{createdAt:new Date}},{upsert:!0})})}updateConversationTitle(e,t){return i(this,void 0,void 0,function*(){yield this.ensureConnected();let n=this.getCollection(this.COLLECTIONS.CONVERSATIONS);yield n.updateOne({conversationId:e},{$set:{title:t,updatedAt:new Date}})})}getConversation(e){return i(this,void 0,void 0,function*(){yield this.ensureConnected();let t=this.getCollection(this.COLLECTIONS.CONVERSATIONS);return yield t.findOne({conversationId:e})})}getConversations(){return i(this,arguments,void 0,function*(e=50,t=0){yield this.ensureConnected();let n=this.getCollection(this.COLLECTIONS.CONVERSATIONS);return yield n.find({}).sort({updatedAt:-1}).skip(t).limit(e).toArray()})}deleteConversation(e){return i(this,void 0,void 0,function*(){yield this.ensureConnected();let t=this.getCollection(this.COLLECTIONS.MESSAGES),n=this.getCollection(this.COLLECTIONS.CONVERSATIONS);yield t.deleteMany({conversationId:e}),yield n.deleteOne({conversationId:e})})}storeLog(e){return i(this,void 0,void 0,function*(){return yield this.insertOne(this.COLLECTIONS.LOGS,e)})}storeLogs(e){return i(this,void 0,void 0,function*(){return yield this.insertMany(this.COLLECTIONS.LOGS,e)})}getLogsByGeneration(e,t){return i(this,void 0,void 0,function*(){yield this.ensureConnected();let n=this.getCollection(this.COLLECTIONS.LOGS).find({generationId:e}).sort({timestamp:1});return t&&n.limit(t),yield n.toArray()})}getLogsByConversation(e,t){return i(this,void 0,void 0,function*(){yield this.ensureConnected();let n=this.getCollection(this.COLLECTIONS.LOGS).find({conversationId:e}).sort({timestamp:-1});return t&&n.limit(t),yield n.toArray()})}getLogsByLevel(e,t){return i(this,void 0,void 0,function*(){yield this.ensureConnected();let n=this.getCollection(this.COLLECTIONS.LOGS).find({level:e}).sort({timestamp:-1});return t&&n.limit(t),yield n.toArray()})}getLogs(){return i(this,arguments,void 0,function*(e={},t=100,n=0){return yield this.find(this.COLLECTIONS.LOGS,e,{sort:{timestamp:-1},limit:t,skip:n})})}deleteOldLogs(e){return i(this,void 0,void 0,function*(){return yield this.deleteMany(this.COLLECTIONS.LOGS,{timestamp:{$lt:e}})})}storeGeneration(e){return i(this,void 0,void 0,function*(){return yield this.insertOne(this.COLLECTIONS.GENERATIONS,e)})}updateGenerationStatus(e,t,n){return i(this,void 0,void 0,function*(){return yield this.updateOne(this.COLLECTIONS.GENERATIONS,{generationId:e},{$set:Object.assign(Object.assign({status:t},"completed"===t||"failed"===t?{endTime:new Date}:{}),n)})})}getGeneration(e){return i(this,void 0,void 0,function*(){return yield this.findOne(this.COLLECTIONS.GENERATIONS,{generationId:e})})}getGenerationsByConversation(e,t){return i(this,void 0,void 0,function*(){return yield this.find(this.COLLECTIONS.GENERATIONS,{conversationId:e},{sort:{startTime:-1},limit:t})})}getActiveGenerations(){return i(this,void 0,void 0,function*(){return yield this.find(this.COLLECTIONS.GENERATIONS,{status:{$in:["pending","streaming"]}},{sort:{startTime:-1}})})}deleteOldGenerations(e){return i(this,void 0,void 0,function*(){return yield this.deleteMany(this.COLLECTIONS.GENERATIONS,{startTime:{$lt:e},status:{$in:["completed","failed"]}})})}storeThought(e){return i(this,void 0,void 0,function*(){return yield this.insertOne(this.COLLECTIONS.THOUGHTS,e)})}storeThoughts(e){return i(this,void 0,void 0,function*(){0!==e.length&&(yield this.insertMany(this.COLLECTIONS.THOUGHTS,e))})}getThought(e){return i(this,void 0,void 0,function*(){return yield this.findOne(this.COLLECTIONS.THOUGHTS,{thoughtId:e})})}getThoughtsByMessage(e){return i(this,void 0,void 0,function*(){return yield this.find(this.COLLECTIONS.THOUGHTS,{messageId:e},{sort:{timestamp:1}})})}getThoughtsByConversation(e,t){return i(this,void 0,void 0,function*(){return yield this.find(this.COLLECTIONS.THOUGHTS,{conversationId:e},{sort:{timestamp:-1},limit:t})})}getThoughtsByGeneration(e){return i(this,void 0,void 0,function*(){return yield this.find(this.COLLECTIONS.THOUGHTS,{generationId:e},{sort:{timestamp:1}})})}getThoughtsBySource(e,t,n){return i(this,void 0,void 0,function*(){let i={source:e};return t&&(i.conversationId=t),yield this.find(this.COLLECTIONS.THOUGHTS,i,{sort:{timestamp:-1},limit:n})})}deleteOldThoughts(e){return i(this,void 0,void 0,function*(){return yield this.deleteMany(this.COLLECTIONS.THOUGHTS,{timestamp:{$lt:e}})})}close(){return i(this,void 0,void 0,function*(){this.client&&(yield this.client.close(),this.client=null,this.db=null,this.collections.clear(),this.connectionPromise=null,console.log("[Database] Closed MongoDB connection"))})}}n.DatabaseManager=o;let s=null},38674,e=>e.a(async(t,n)=>{try{e.s(["getRed",()=>r,"red",()=>a]);var i=e.i(95669);let t={redisUrl:process.env.REDIS_URL||"redis://localhost:6379",vectorDbUrl:process.env.VECTOR_DB_URL||"http://localhost:8200",databaseUrl:process.env.DATABASE_URL||"http://localhost:5432",defaultLlmUrl:process.env.LLM_URL||"http://localhost:11434"},o=null;async function r(){return o||(o=new i.Red(t),await o.load("webapp-api"),console.log("âœ… Red AI initialized successfully")),o}let s=null;s=r();let a=await s;process.env.BEARER_TOKEN||Date.now(),n()}catch(e){n(e)}},!0),32430,(e,t,n)=>{},21846,e=>e.a(async(t,n)=>{try{e.s(["GET",()=>o]);var i=e.i(38674),r=t([i]);async function o(e,{params:t}){let{messageId:n}=await t;console.log(`[Stream] Client connecting to message: ${n}`);try{let e,t=(await (0,i.getRed)()).messageQueue,r=new TextEncoder,o=null,s=!1,a=!1,l=t=>{if(s||a)return!1;try{return e.enqueue(t),!0}catch{return a=!0,!1}},d=()=>{if(!a)try{e.close(),a=!0}catch{a=!0}},c=new ReadableStream({async start(i){e=i;try{for await(let e of o=t.subscribeToMessage(n)){if(s){console.log("[Stream] Stream cancelled, stopping iteration");break}if("init"===e.type&&e.existingContent)for(let t of(console.log(`[Stream] Sending ${e.existingContent.length} chars of existing content`),e.existingContent.match(/.{1,50}/g)||[])){if(s)break;let e={type:"content",content:t};if(!l(r.encode(`data: ${JSON.stringify(e)}

`)))break}else if("chunk"===e.type){let t={type:"content",content:e.content};if(!l(r.encode(`data: ${JSON.stringify(t)}

`)))break}else if("thinking"===e.type){let t={type:"thinking",content:e.content};if(!l(r.encode(`data: ${JSON.stringify(t)}

`)))break}else if("tool_status"===e.type){let t={type:"tool_status",status:e.status,action:e.action};l(r.encode(`data: ${JSON.stringify(t)}

`))}else if("complete"===e.type){let t={type:"complete",metadata:e.metadata};l(r.encode(`data: ${JSON.stringify(t)}

`)),l(r.encode("data: [DONE]\n\n"));break}else if("error"===e.type){let t={type:"error",error:e.error};l(r.encode(`data: ${JSON.stringify(t)}

`));break}}d()}catch(t){console.error("[Stream] Error:",t);let e={type:"error",error:t instanceof Error?t.message:String(t)};l(r.encode(`data: ${JSON.stringify(e)}

`)),d()}},async cancel(){if(console.log(`[Stream] Client disconnected from message: ${n}`),s=!0,o&&"function"==typeof o.return)try{await o.return()}catch{}}});return new Response(c,{headers:{"Content-Type":"text/event-stream","Cache-Control":"no-cache, no-transform",Connection:"keep-alive","X-Accel-Buffering":"no"}})}catch(e){return console.error("[Stream] Failed to create stream:",e),new Response(JSON.stringify({error:{message:e instanceof Error?e.message:"Failed to create stream",type:"stream_error"}}),{status:500,headers:{"Content-Type":"application/json"}})}}[i]=r.then?(await r)():r,n()}catch(e){n(e)}},!1),33498,e=>e.a(async(t,n)=>{try{e.s(["handler",()=>E,"patchFetch",()=>m,"routeModule",()=>I,"serverHooks",()=>N,"workAsyncStorage",()=>T,"workUnitAsyncStorage",()=>L]);var i=e.i(47909),r=e.i(74017),o=e.i(96250),s=e.i(59756),a=e.i(61916),l=e.i(69741),d=e.i(16795),c=e.i(87718),u=e.i(95169),h=e.i(47587),p=e.i(66012),O=e.i(70101),y=e.i(26937),C=e.i(10372),g=e.i(93695);e.i(52474);var v=e.i(220),f=e.i(21846),S=t([f]);[f]=S.then?(await S)():S;let I=new i.AppRouteRouteModule({definition:{kind:r.RouteKind.APP_ROUTE,page:"/api/v1/messages/[messageId]/stream/route",pathname:"/api/v1/messages/[messageId]/stream",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/src/app/api/v1/messages/[messageId]/stream/route.ts",nextConfigOutput:"",userland:f}),{workAsyncStorage:T,workUnitAsyncStorage:L,serverHooks:N}=I;function m(){return(0,o.patchFetch)({workAsyncStorage:T,workUnitAsyncStorage:L})}async function E(e,t,n){var i;let o="/api/v1/messages/[messageId]/stream/route";o=o.replace(/\/index$/,"")||"/";let f=await I.prepare(e,t,{srcPage:o,multiZoneDraftMode:!1});if(!f)return t.statusCode=400,t.end("Bad Request"),null==n.waitUntil||n.waitUntil.call(n,Promise.resolve()),null;let{buildId:S,params:m,nextConfig:E,isDraftMode:T,prerenderManifest:L,routerServerContext:N,isOnDemandRevalidate:x,revalidateOnlyGenerated:A,resolvedPathname:b}=f,R=(0,l.normalizeAppPath)(o),w=!!(L.dynamicRoutes[R]||L.routes[b]);if(w&&!T){let e=!!L.routes[b],t=L.dynamicRoutes[R];if(t&&!1===t.fallback&&!e)throw new g.NoFallbackError}let M=null;!w||I.isDev||T||(M=b,M="/index"===M?"/":M);let D=!0===I.isDev||!w,G=w&&!D,U=e.method||"GET",$=(0,a.getTracer)(),j=$.getActiveScopeSpan(),H={params:m,prerenderManifest:L,renderOpts:{experimental:{cacheComponents:!!E.experimental.cacheComponents,authInterrupts:!!E.experimental.authInterrupts},supportsDynamicResponse:D,incrementalCache:(0,s.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:null==(i=E.experimental)?void 0:i.cacheLife,isRevalidate:G,waitUntil:n.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,n,i)=>I.onRequestError(e,t,i,N)},sharedContext:{buildId:S}},_=new d.NodeNextRequest(e),k=new d.NodeNextResponse(t),P=c.NextRequestAdapter.fromNodeNextRequest(_,(0,c.signalFromNodeResponse)(t));try{let i=async n=>I.handle(P,H).finally(()=>{if(!n)return;n.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let i=$.getRootSpanAttributes();if(!i)return;if(i.get("next.span_type")!==u.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${i.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let r=i.get("next.route");if(r){let e=`${U} ${r}`;n.setAttributes({"next.route":r,"http.route":r,"next.span_name":e}),n.updateName(e)}else n.updateName(`${U} ${e.url}`)}),l=async a=>{var l,d;let c=async({previousCacheEntry:r})=>{try{if(!(0,s.getRequestMeta)(e,"minimalMode")&&x&&A&&!r)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let o=await i(a);e.fetchMetrics=H.renderOpts.fetchMetrics;let l=H.renderOpts.pendingWaitUntil;l&&n.waitUntil&&(n.waitUntil(l),l=void 0);let d=H.renderOpts.collectedTags;if(!w)return await (0,p.sendResponse)(_,k,o,H.renderOpts.pendingWaitUntil),null;{let e=await o.blob(),t=(0,O.toNodeOutgoingHttpHeaders)(o.headers);d&&(t[C.NEXT_CACHE_TAGS_HEADER]=d),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let n=void 0!==H.renderOpts.collectedRevalidate&&!(H.renderOpts.collectedRevalidate>=C.INFINITE_CACHE)&&H.renderOpts.collectedRevalidate,i=void 0===H.renderOpts.collectedExpire||H.renderOpts.collectedExpire>=C.INFINITE_CACHE?void 0:H.renderOpts.collectedExpire;return{value:{kind:v.CachedRouteKind.APP_ROUTE,status:o.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:n,expire:i}}}}catch(t){throw(null==r?void 0:r.isStale)&&await I.onRequestError(e,t,{routerKind:"App Router",routePath:o,routeType:"route",revalidateReason:(0,h.getRevalidateReason)({isRevalidate:G,isOnDemandRevalidate:x})},N),t}},u=await I.handleResponse({req:e,nextConfig:E,cacheKey:M,routeKind:r.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:L,isRoutePPREnabled:!1,isOnDemandRevalidate:x,revalidateOnlyGenerated:A,responseGenerator:c,waitUntil:n.waitUntil});if(!w)return null;if((null==u||null==(l=u.value)?void 0:l.kind)!==v.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==u||null==(d=u.value)?void 0:d.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});(0,s.getRequestMeta)(e,"minimalMode")||t.setHeader("x-nextjs-cache",x?"REVALIDATED":u.isMiss?"MISS":u.isStale?"STALE":"HIT"),T&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let g=(0,O.fromNodeOutgoingHttpHeaders)(u.value.headers);return(0,s.getRequestMeta)(e,"minimalMode")&&w||g.delete(C.NEXT_CACHE_TAGS_HEADER),!u.cacheControl||t.getHeader("Cache-Control")||g.get("Cache-Control")||g.set("Cache-Control",(0,y.getCacheControlHeader)(u.cacheControl)),await (0,p.sendResponse)(_,k,new Response(u.value.body,{headers:g,status:u.value.status||200})),null};j?await l(j):await $.withPropagatedContext(e.headers,()=>$.trace(u.BaseServerSpan.handleRequest,{spanName:`${U} ${e.url}`,kind:a.SpanKind.SERVER,attributes:{"http.method":U,"http.target":e.url}},l))}catch(t){if(t instanceof g.NoFallbackError||await I.onRequestError(e,t,{routerKind:"App Router",routePath:R,routeType:"route",revalidateReason:(0,h.getRevalidateReason)({isRevalidate:G,isOnDemandRevalidate:x})}),w)throw t;return await (0,p.sendResponse)(_,k,new Response(null,{status:500})),null}}n()}catch(e){n(e)}},!1)];

//# sourceMappingURL=%5Broot-of-the-server%5D__25cf4135._.js.map